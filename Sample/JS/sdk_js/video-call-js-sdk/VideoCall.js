(function(){let t,e,n,o,i,c,a,r;const s="https://api.idg.vnpt.vn/",l=s+"router-service/api/",d={"IDG-00000000":"Thành công! - IDG-00000000","IDG-20000001":"Not null! - IDG-20000001","IDG-20000004":"Kích thước từ 0-255! - IDG-20000004","IDG-20000003":"Kích thước từ 0-4000! - IDG-20000003","IDG-20000005":"Kích thước từ 0-300! - IDG-20000005","IDG-20000006":"Không thuộc định dạng devicetype! - IDG-20000006","IDG-20000007":"Không thuộc định dạng statuscaller! - IDG-20000007","IDG-20000008":"Không thuộc kiểu enum môi trường! - IDG-20000008","IDG-20000100":"Không tìm thấy thiết bị người nhận! - IDG-20000100","IDG-20000201":"Cuộc gọi đang thực hiện! - IDG-20000201","IDG-20000202":"Không tìm thấy cuộc gọi! - IDG-20000202","IDG-20000203":"Người nhận đang trong cuộc gọi khác! - IDG-20000203","IDG-20000101":"Thiết bị người nhận và người gọi là 1! - IDG-20000101","IDG-20000210":"Không tìm thấy host! - IDG-20000210","IDG-20000404":"Không tìm thấy token! - IDG-20000404","IDG-20000211":"Không tìm thấy room! - IDG-20000211","IDG-20000213":"Không phải thiết bị nguồn! - IDG-20000213","IDG-20000214":"Không phải thiết bị đích! - IDG_20000214","IDG-20000215":"Không tồn tại cấu hình của token! - IDG_20000215","IDG-20000216":"Đã có lỗi xảy ra! - IDG-20000216","IDG-20000217":"Số lương thiết bị đăng ký vượt quá số lượng cho phép - IDG-20000217","IDG-20000218":"Thông tin người nhận không hợp lệ - IDG-20000218","IDG-20000219":"Không tìm thấy người gọi, nhận trong cuộc gọi - IDG-20000219","IDG-20000220":"Người nhận và người gọi là một người - IDG-20000220","IDG-20000420":"Cuộc gọi đã kết thúc - IDG-20000420","IDG-20000421":"Cuộc gọi bị từ chối - IDG-20000421","IDG-20000330":"Có lỗi xảy ra khi lấy file ghi âm - IDG-20000330","IDG-20000331":"Người gọi không có quyền truy cập file - IDG-20000331","IDG-20000232":"Cuộc gọi không có chế độ ghi âm, hình - IDG-20000332","IDG-20003001":"Lỗi socket time out - IDG-20000216","IDG-20003002":"Vui lòng kiểm tra kết nối mạng - IDG-20003002","IDG-20003003":"Lỗi kết nối: không kết nối được máy chủ! - IDG-20003003","IDG-20003004":"Lỗi kết nối: quá thời gian hồi đáp! - IDG-20003004","IDG-20003005":"Lỗi socket với message chi tiết - IDG-20003005","IDG-20003006":"Lỗi không xác định với message chi tiết - IDG-20003006","IDG-20002400":"Token đã bị khoá","IDG-20002401":"Bạn không có quyền truy cập","IDG-20002402":"Quá số lượng cuộc gọi đồng thời cho phép","IDG-20002403":"Quá thời lượng cuộc gọi cho phép"};window.addEventListener("message",function(t){"capture"==t.data.id&&r&&r(t.data.data)}),n=function(){const t='<div class="modalSDK" id="ratingModal" tabindex="-1" role="dialog">       <div class="modalContentSDK">           <div class="modalBodySDK">               <div id="review-form-container">                    <div id="review-form">                       <label>Đánh giá chất lượng cuộc gọi</label>                       <div class="fieldset">                            <div class="star-rating">                               <input                                    type="radio"                                   name="rating"                                   value="1"                               /><i></i>                               <input                                   type="radio"                                   name="rating"                                   value="2"                                /><i></i>                               <input                                   type="radio"                                   name="rating"                                   value="3"                               /><i></i>                               <input                                   type="radio"                                   name="rating"                                   value="4"                               /><i></i>                               <input                                   type="radio"                                   name="rating"                                   value="5"                               /><i></i>                           </div>                       </div>                       <textarea id="reviewComments" placeholder="Đánh giá chất lượng cuộc gọi" id="reviewComments" cols="20" rows="5"></textarea>                       <div class="fieldset right">                           <button id="closeRatingButton" class="btn btn-outline-danger" data-dismiss="modal">Hủy</button>                           <button id="ratingButton" class="btn btn-outline-primary" data-dismiss="modal">Gửi</button>                       </div>                   </div>               </div>           </div>       </div></div>',e='<div class="modalSDK" id="receivingCalling">       <div class="modalContentSDK">           <div class="modalBodySDK">               <div class="col-12 mb-2 text-center">                   <span>Bạn có một cuộc gọi video từ admin hệ thống, Bạn có muốn nhận cuộc gọi ngay lúc này?</span>               </div>               <div class="row justify-content-center mx-2">                   <button id="acceptCall" type="button" class="btnSDK btnOutlinePrimarySDK mr-2" > Đồng ý</button>                   <button id="rejectCall" type="button" class="btnSDK btnOutlineDangerSDK" data-dismiss="modal"> Hủy</button>                   </div>               </div>           </div>       </div></div>',n='<div class="modalSDK" id="msgModal" tabindex="-1" role="dialog">       <div class="modalContentSDK">           <div class="modalBodySDK">               <div class="col-12 mb-2 text-center">                  <i id="iconMsg" class="fas fa-exclamation-circle" style="color:red;font-size: 44px;"></i>               </div>               <div class="col-12 mb-2 text-center">                   <span ><b id="errMsg"></b></span>               </div>               <div class="row justify-content-center mx-2">                   <button id="closeBtn" type="button" class="btnSDK btnOutlinePrimarySDK" data-dismiss="modal"> Đóng</button>                   </div>               </div>           </div>       </div></div>';function o(){}return o.prototype.initRatingModal=function(e){const n=document.getElementById("root");let o,i;n?n.insertAdjacentHTML("afterbegin",t):document.body.insertAdjacentHTML("afterbegin",t);const c=document.querySelectorAll('input[type=radio][name="rating"]'),r=document.getElementById("reviewComments"),s=(document.getElementById("review-form"),document.getElementById("ratingModal")),l=document.getElementById("closeRatingButton"),d=document.getElementById("ratingButton");function g(t){o=this.value}r.addEventListener("change",function(t){i=this.value}),Array.prototype.forEach.call(c,function(t){t.addEventListener("change",g)}),l.onclick=function(){s.style.display="none"},d.onclick=function(){(o||i)&&a.submitRating(e,o,i),s.style.display="none"},s.style.display="block"},o.prototype.initReceivingModal=function(t,n){const o=document.getElementById("root");o?o.insertAdjacentHTML("afterbegin",e):document.body.insertAdjacentHTML("afterbegin",e);const c=document.getElementById("receivingCalling"),r=document.getElementById("acceptCall"),s=document.getElementById("rejectCall");r.onclick=function(){"CONNECTED"===a.status?(a.acceptCall(t),c.style.display="none"):i("","","Đang kết nối lại, vui lòng chờ trong giây lát","")},s.onclick=function(){"CONNECTED"===a.status?(a.rejectCall(t),c.style.display="none"):i("","","Đang kết nối lại, vui lòng chờ trong giây lát","")},c.style.display="block"},o.prototype.openMsgModal=function(t,e){const o=document.getElementById("root");o?o.insertAdjacentHTML("afterbegin",n):document.body.insertAdjacentHTML("afterbegin",n);const i=document.getElementById("errMsg"),c=document.getElementById("iconMsg");"error"===t&&c?(c.className="fas fa-exclamation-circle",c.style.color="red"):(c.className="fas fa-check-circle",c.style.color="green"),i.innerText=e||"";const a=document.getElementById("closeBtn"),r=document.getElementById("msgModal");r.style.display="block",a.onclick=function(){r.style.display="none"}},o}(),e=function(){function t(t,e,n){this.url=t,this.body=e,this.config=n}return t.prototype.post=async function(){try{c||await this.getAuthen();const t=await fetch(this.url,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json;charset=UTF-8","Token-id":this.config.token_id,"Token-key":this.config.token_key,"mac-address":"WEB-001",Authorization:c},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(this.body)});if(t.ok)return t.json();const e=await t.text();throw JSON.parse(e)}catch(t){return t&&"invalid_token"===t.error?(await this.getAuthen(),this.post()):(console.log(t),i(t,t.message,null,"error"),t)}},t.prototype.get=async function(){try{c||await this.getAuthen();const t=await fetch(this.url,{method:"GET",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json;charset=UTF-8","Token-id":this.config.token_id,"Token-key":this.config.token_key,"mac-address":"WEB-001",Authorization:c},redirect:"follow",referrerPolicy:"no-referrer"});if(t.ok)return t.json();const e=await t.text();throw JSON.parse(e)}catch(t){return t&&"invalid_token"===t.error?(await this.getAuthen(),this.get()):(i(t,t.message,null,"error"),t)}},t.prototype.delete=async function(){try{c||await this.getAuthen();const t=await fetch(this.url,{method:"DELETE",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json;charset=UTF-8","Token-id":this.config.token_id,"Token-key":this.config.token_key,"mac-address":"WEB-001",Authorization:c},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(this.body)});if(t.ok)return t.json();const e=await t.text();throw JSON.parse(e)}catch(t){return t&&"invalid_token"===t.error?(await this.getAuthen(),this.delete()):(i(t,t.message,null,"error"),t)}},t.prototype.postDataForAuthentication=async function(t,e,n){try{return(await fetch(t,{method:"POST",mode:"cors",cache:"no-cache",credentials:"same-origin",headers:{"Content-Type":"application/json"},redirect:"follow",referrerPolicy:"no-referrer",body:JSON.stringify(e)})).json()}catch(t){return t}},t.prototype.getAuthen=async function(){const t={client_id:this.config.client_id,client_secret:this.config.client_secret,grant_type:"client_credentials"},e=await this.postDataForAuthentication(s+"auth-service/oauth/token",t,this.config);return e.access_token&&(c="Bearer "+e.access_token),e.access_token},t}(),t=function(){let t,o,c,a,d,g,h,u;function m(t,e){this.config=e,this.windowCall=null,this.pageShow=!1,this.url=t,this.status="DISCONNECTED",this.api=null}return m.prototype.registerDevice=async function(n,o){const i={deviceId:t(),deviceToken:n,deviceTypeId:"WEB",idgTokenId:this.config.token_id,lastDate:new Date,personIdApp:n,personName:o,topicUsing:this.getTopicUsing(n)};return await new e(l+"v2/register-device",i,this.config).post()},m.prototype.createCall=async function(n,c,a){try{if("DISCONNECTED"===this.status)throw"Chưa kết nối socket, vui lòng thử lại sau!";const r={callerId:n,callerName:c,deviceId:t(),idgTokenId:this.config.token_id,reciverCallers:a},s=await new e(l+"v2/create-call",r,this.config).post();return"IDG-00000000"===s.message?(o("roomInfo",{roomId:s.object.roomId,token:s.object.token,domain:s.object.domain,caller:c}),this.url&&this.openWindowCall(n),this.setTimeoutEndcall(n),s):s}catch(t){return i("","",t||"Đã có lỗi xảy ra","error"),t}},m.prototype.acceptCall=async function(n){try{const o=JSON.parse(c("roomInfo")),a={callerId:n,deviceId:t(),idgTokenId:this.config.token_id,roomId:o.roomId},r=await new e(l+"v2/accept-call",a,this.config).post();return"IDG-00000000"===r.message?(this.url&&this.openWindowCall(n),r):(i(r,r.message,null,"error"),r)}catch(t){console.log(t),this.endCall(n),i("","","Vui lòng cho phép Pop-ups bật để thực hiện cuộc gọi ","error")}},m.prototype.endCall=async function(n){g(),u(),this.removeIframe();const o=JSON.parse(c("roomInfo"));let i;if(o){const c={callerId:n,deviceId:t(),idgTokenId:this.config.token_id,roomId:o.roomId};i=await new e(l+"v2/end-call",c,this.config).post()}return i},m.prototype.rejectCall=async function(n){u();const o=JSON.parse(c("roomInfo")),i={callerId:n,deviceId:t(),idgTokenId:this.config.token_id,roomId:o.roomId};return await new e(l+"v2/reject-call",i,this.config).post()},m.prototype.removeCall=async function(t){const n=JSON.parse(c("roomInfo")),o={callerId:t,idgTokenId:this.config.token_id,roomId:n.roomId};return await new e(l+"v2/remove-call",o,this.config).post()},m.prototype.removeDevice=async function(n){const o={deviceId:t(),idgTokenId:this.config.token_id,personIdApp:n,deviceTypeId:"WEB"};return localStorage.removeItem("roomInfo"),await new e(l+"v2/remove-device",o,this.config).delete()},m.prototype.getFile=async function(t){try{const n=JSON.parse(c("roomInfo")),o=t||n.roomId;return await new e(l+"v2/external/get-file?roomId="+o,"",this.config).get()}catch(t){console.log(t),i("","","Đã có lỗi xảy ra","error")}},m.prototype.submitRating=async function(n,o,i){const a=JSON.parse(c("roomInfo"));let r;if(a){const c={callComment:i,callQuality:o,callerId:n,deviceId:t(),idgTokenId:this.config.token_id,roomId:a.roomId};r=await new e(l+"v2/external/rating",c,this.config).post()}return r},m.prototype.setTimeoutEndcall=function(t){var e=this;d=setTimeout(function(){console.log("jump time out"),e.endCall(t),e.windowCall&&e.windowCall.close(),u()},7e4)},m.prototype.openWindowCall=function(t){var e=this;g();const n=void 0!==window.screenLeft?window.screenLeft:window.screenX,o=void 0!==window.screenTop?window.screenTop:window.screenY,i=window.innerWidth?window.innerWidth:document.documentElement.clientWidth?document.documentElement.clientWidth:window.screen.width,c=window.innerHeight?window.innerHeight:document.documentElement.clientHeight?document.documentElement.clientHeight:window.screen.height,a=i/window.screen.availWidth,r=(i-980)/2/a+n,s=(c-500)/2/a+o;this.windowCall=window.open(this.url,"videocall",`width=1280,height=600,top=${s},left=${r},menubar=yes,location=yes,resizable=yes,scrollbars=yes,status=yesnp`),window.addEventListener("offline",function(){e.windowCall.close()}),this.windowCall.onpageshow=(t=>{this.pageShow=!0}),this.windowCall.onpagehide=(e=>{this.pageShow&&(this.endCall(t),this.pageShow=!1)})},m.prototype.handleReceivingMessage=function(t,e){switch(h(),e.title){case"ACCEPTED":return console.log("ACCEPTED"),void u();case"PENDING":return console.log("PENDING"),o("roomInfo",{roomId:e.roomId,token:e.token,domain:e.domain}),new n(this.config).initReceivingModal(t,e),void this.setTimeoutEndcall(t);case"REJECTED":return console.log("REJECTED"),u(),this.removeIframe(),i("","","Cuộc gọi đã bị từ chối!",""),this.windowCall&&this.windowCall.close(),void g();case"DENIED":return console.log("DENIED"),void g();case"FINISHED":return console.log("FINISHED"),i("","","Cuộc gọi đã kết thúc!",""),this.windowCall&&this.windowCall.close(),this.removeIframe(),void g();case"TIMEOUT":return console.log("timeout"),this.windowCall&&this.windowCall.close(),this.removeIframe(),void g();default:return}},m.prototype.initSocket=async function(t,n,o,i,c){try{var r=this;const l=await new e(null,null,this.config).getAuthen();let d=`wss://${s.replace("https://","")}router-service/websocket?access_token=${l}`,g=new WebSocket(d);a=t.over(g);let h=this.getTopicUsing(n);return c||(a.heartbeat={outgoing:0,incoming:0}),a.connect({},function(t){o&&o(t.command),r.status="CONNECTED",a.subscribe("/topic/"+h,function(t){const e=JSON.parse(JSON.stringify(t.body));i&&i(JSON.parse(e)),r.handleReceivingMessage(n,JSON.parse(e))},{id:h})},e=>{e&&"[object String]"===Object.prototype.toString.call(e)&&0===e.lastIndexOf("Whoops! Lost connection to",0)&&(o&&o("DISCONNECTED"),this.status="DISCONNECTED",setTimeout(()=>{this.initSocket(t,n,o,i)},3e3))}),a}catch(t){console.log(t)}},m.prototype.disconnectSocket=function(){null!==a&&a.disconnect()},m.prototype.removeIframe=function(){const t=document.querySelector("#meet");if(t)for(;t.firstChild;)t.removeChild(t.firstChild)},m.prototype.initVideoCall=function(e,n,o,i){try{let c=JSON.parse(localStorage.getItem("roomInfo"));document.querySelector("#meet");this.removeIframe();const a={roomName:c.roomId?c.roomId:"",width:o,height:i,jwt:c.token,configOverwrite:{subject:" "},userInfo:{displayName:c.caller,email:t()},parentNode:document.querySelector("#meet")};return this.api=new e(c.domain.replace("https://",""),a),this.api.addEventListener("readyToClose",async()=>{await this.endCall(n),window.open("","_self").close()}),this.api}catch(t){console.log(t)}},m.prototype.getTopicUsing=function(e){return this.config.token_id+"_"+e+"_"+t()},m.prototype.createUUID=function(){const t=([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,t=>(t^crypto.getRandomValues(new Uint8Array(1))[0]&15>>t/4).toString(16));return c("uuid")||o("uuid",t),t},m.prototype.capture=function(t){r=t,console.log(this.windowCall);const e=this.api.getIFrame(),n={id:"capture"};console.log("capture",n),e.contentWindow.postMessage(n,"*")},g=function(){const t=document.getElementById("myModal"),e=document.getElementById("receivingCalling");t&&(t.style.display="none"),e&&(e.style.display="none")},h=function(){const t=document.getElementById("msgModal");t&&(t.style.display="none")},u=function(){clearTimeout(d)},t=function(){try{return c("uuid")&&c("uuid").replace(/"/g,"")}catch(t){console.log(t),i("","","Lỗi không xác định","error")}},o=function(t,e){try{return localStorage.setItem(t,JSON.stringify(e)),!0}catch(t){console.log(t)}},c=function(t){try{return localStorage.getItem(t)}catch(t){}},m}(),i=function(t,e,o,i){t.error&&t.message&&d[t.message]?(new n).openMsgModal(i,d[t.message]):t.error&&t.message&&!d[t.message]?(new n).openMsgModal(i,"Lỗi không xác định! Vui lòng thử lại"):o?(new n).openMsgModal(i,o):"IDG-00000000"===t.message&&(new n).openMsgModal(i,d[t.message])},o={initConfig:function(e,n){return a=new t(e,n)}},"undefined"!=typeof exports&&null!==exports&&(exports.VideoCallSDK=o),"undefined"!=typeof window&&null!==window?window.VideoCallSDK=o:exports||(self.VideoCallSDK=o)}).call(this);